!function(t){function i(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){(function(){var t,i;i=void 0,t=void 0,DirectPano.show_pano=function(){var o,n;o=$("<img id='start-image'/>"),o.css({visibility:"visible",height:Math.min(DirectPano.initial_height,window.innerHeight)+"px",width:Math.min(DirectPano.initial_width,window.innerWidth)+"px","z-index":"1",position:"absolute",left:"0px",top:"0px","background-image":"./panos/1.tiles/mobile_l.jpg","background-size":"cover"}),$("#"+DirectPano.pano_div_id).append(o),$("#panos-list").remove(),$("#"+DirectPano.pano_div_id).append("<div id='panos-list'></div>"),n=$("#panos-list"),i=e(1),$.getJSON("data.json",function(e){var o;for(i.house=e,o=0;o<Object.keys(i.house).length;)i.house[o][SIDE_PANEL]===!0&&(n.append("<div id='panos-list-entry-"+o+"'>"+i.house[o][TITLE]+"</div>"),$("#panos-list-entry-"+o).attr("pano_id",parseInt(o)),$("#panos-list-entry-"+o).bind("click touchstart",function(){i.Transition.moving===!1&&i.Transition.start(null,this.getAttribute("pano_id"))})),o++;i.Annotation=new i.annotation,i.Annotation.add_annotations(0),i.scene.children.length=0,i.add_listeners(),i.Hotspot=new i.hotspot,i.Transition=new i.transition,i.Hotspot.add_hotspots(0),t=new i.animation,i.Config.isUserInteracting=!0})},DirectPano.remove_pano=function(){t.destroy=!0,t=null,i.remove_listeners(),i.Hotspot.destroy_hotspot(),i.Hotspot=null,i.Transition.destroy_transition(),i.Transition=null,i.Annotation.destroy_annotation(),i.Annotation=null,i.destroy()}}).call(this)},function(t,i,e){(function(){var i,o,n,a,r,s,h,l,p,d,c,u,_,f;_=e(2),a=void 0,r=void 0,n=void 0,o=void 0,f=function(t){var i,e,o,n;switch(o=t.changedTouches,i=o[0],n="",t.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}e=document.createEvent("MouseEvent"),e.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(e),t.preventDefault()},l=function(t){var i,e,s;t.preventDefault(),_.Config.current_lon=_.Config.lon,_.Config.target_lon=_.Config.lon,_.Config.current_lat=_.Config.lat,_.Config.target_lat=_.Config.lat,_.Config.isUserInteracting=!0,a=t.clientX,r=t.clientY,n=_.Config.lon,o=_.Config.lat,s=new THREE.Vector3,i=$("#"+DirectPano.pano_div_id),s.set(t.clientX/i.outerWidth()*2-1,2*-(t.clientY/i.outerHeight())+1,.5),s.unproject(_.camera),_.raycaster.set(_.camera.position,s.sub(_.camera.position).normalize()),e=_.raycaster.intersectObjects(_.scene.children,!0),e.length>0&&"hotspot"===e[0].object.name&&_.Transition.start(e[0].object.hotspot_id)},p=function(t){var i;_.Config.isUserInteracting===!0&&(i=.3,_.Config.target_lon=(a-t.clientX)*i+n,_.Config.target_lat=(t.clientY-r)*i+o)},d=function(t){_.Config.isUserInteracting=!1,_.Config.stop_time=Date.now(),_.Config.autoplay=!1},c=function(t){var i,e,o;e=t.pageX,o=t.pageY,i=document.elementFromPoint(e,o),"panos-list"!==$("#"+i.id).parent().attr("id")&&(t.wheelDeltaY?_.camera.fov-=.05*t.wheelDeltaY:t.wheelDelta?_.camera.fov-=.05*t.wheelDelta:t.detail&&(_.camera.fov+=1*t.detail),_.camera.fov=Math.max(60,Math.min(90,_.camera.fov)),_.camera.updateProjectionMatrix())},s=function(t){var i,e,o;o=void 0,t||(t=window.event),_.Config.isUserInteracting=!0,e=t.keyCode,37===e?(_.Config.current_lon=_.Config.lon,_.Config.target_lon=_.Config.lon-20):39===e?(_.Config.current_lon=_.Config.lon,_.Config.target_lon=_.Config.lon+20):38===e?_.Transition.moving===!1&&(o=_.Hotspot.front_nearest_hotspot(_.Transition.current_pano),-1!==o&&_.Transition.start(o)):40===e?_.Transition.moving===!1&&(o=_.Hotspot.back_nearest_hotspot(_.Transition.current_pano),-1!==o&&_.Transition.start(o)):27===e&&(i=$("#"+DirectPano.pano_div_id),i.width()===window.innerWidth&&i.height()===window.innerHeight&&_.escape_fullscreen())},h=function(t){_.Config.isUserInteracting=!1,_.Config.stop_time=Date.now(),_.Config.autoplay=!1},i=function(){return $("#"+DirectPano.pano_div_id).on({click:function(t){$("#"+DirectPano.pano_div_id).focus()},mousedown:function(t){l(t)},mousemove:function(t){p(t)},mouseup:function(t){d(t)},mousewheel:function(t){c(t.originalEvent)},DOMMouseScroll:function(t){c(t.originalEvent)},touchstart:function(t){f(t.originalEvent)},touchmove:function(t){f(t.originalEvent)},touchend:function(t){f(t.originalEvent)},keydown:function(t){s(t)},keyup:function(t){h(t)}})},u=function(){$("#"+DirectPano.pano_div_id).off()},_.add_listeners=i,_.remove_listeners=u,t.exports=_}).call(this)},function(t,i,e){(function(){var i,o;i=e(3),o=function(){function t(){var t,e;this.current_pano=0,this.moving=!1,this.destroy=!1,i.clear_images={},i.blur_images={},e=i.house[this.current_pano][PATH],t=i.house[this.current_pano][BLUR_PATH],this.blur_pano=new i.Pano(0,!0),this.clear_pano=new i.Pano(0,!1),this.blur_pano.create_pano(t,0),this.clear_pano.create_pano(e,1).done(function(){var t;return t=1e3,$("#start-image").fadeTo(t,0,function(){$("#start-image").remove(),i.Config.isUserInteracting=!1})}),this.preload_images().done(function(t){return function(){t.preload_panel_images()}}(this))}return t.prototype.save_clear_images=function(){var t,e,o;for(t=this.current_pano,o=this.clear_pano.img_width/this.clear_pano.tile_width*(this.clear_pano.img_width/this.clear_pano.tile_width),e=0;6>e;)!function(){var n,a,r;for(r=new THREE.Texture(i.texture_placeholder),n=e,a=0;o>a;)!function(){var o,n,s;n=a,s=i.house[t][PATH],s=s.replace(/%s/g,i.Config.img_name[e]),s=s.replace(/%h/g,a%2+1),s=s.replace(/%v/g,parseInt(a/2)+1),i.clear_images[s]||(o=new Image,o.onload=function(){o.onload=null,r.image=this,r.needsUpdate=!0,console.log(s),i.clear_images[s]=o},o.src=s)}(),a++}(),e++},t.prototype.preload_images=function(){var t,e,o,n;for(o=0,n=0,e=[],t=this.current_pano;o<i.house[t][HOTSPOTS].length;)!function(){var a,r,s,h;s=i.house[t][HOTSPOTS][o][TO_ID],e[n++]=$.Deferred(),a=i.house[s][BLUR_PATH],i.blur_images[a]||(h=new THREE.Texture(i.texture_placeholder),r=new Image,r.onload=function(){r.onload=null,h.image=this,h.needsUpdate=!0,i.blur_images[a]=r,e[n-1].resolve()},r.src=a)}(),o++;return $.when.apply($,e).done(function(){}).promise()},t.prototype.preload_panel_images=function(){var t,e,o,n,a;for(e=0;e<Object.keys(i.house).length;)i.house[e][SIDE_PANEL]===!0&&(n=e,t=i.house[n][BLUR_PATH],i.blur_images[t]||(a=new THREE.Texture(i.texture_placeholder),o=new Image,o.onload=function(){o.onload=null,a.image=this,a.needsUpdate=!0,i.blur_images[t]=o},o.src=t)),e++},t.prototype.start=function(t,e){var o,n,a,r,s,h,l,p;for(o=this.current_pano,h=null,a=0,r=0,l=0,n=0,null!==t?(h=i.house[o][HOTSPOTS][t][TO_ID],r=i.house[o][HOTSPOTS][t][ANGLE],a=i.house[o][HOTSPOTS][t][ERROR],n=60):(h=e,a=0),$("div[id^=panos-list-entry-]").removeClass("active"),p=i.house[h][TITLE],s=0;s<Object.keys(i.house).length;){if(i.house[s][TITLE]===p&&i.house[s][SIDE_PANEL]===!0){$("#panos-list-entry-"+s).addClass("active");break}s++}this.moving=!0,this.current_pano=h,this.save_clear_images(),null!==t?l=this.find_rotation_angle(r):(i.Config.lon=i.house[h][START_POSITION],i.Config.lat=0),i.Hotspot.remove_hotspots(),i.Annotation.remove_annotations(),this.preload_images(),this.load_blur_pano(a,r,n).done(function(t){return function(){t.old_pano_to_blur_pano(a,r,l,n)}}(this))},t.prototype.find_rotation_angle=function(t){var e;for(e=t-i.Config.lon;e>180;)e-=360;for(;-180>e;)e+=360;return e>50?e=(e-180)%360:-50>e&&(e=(e+180)%360),e+=i.Config.lon},t.prototype.load_blur_pano=function(t,e,o){var n,a,r,s,h;if(this.destroy)return $.when().done(function(){}).promise();for(n=[],s=this.blur_pano.img_width/this.blur_pano.tile_width*(this.blur_pano.img_width/this.blur_pano.tile_width),a=0;6*s>a;)n[a]=$.Deferred(),a++;for(this.blur_pano.pano_id=this.current_pano,a=0;6>a;){for(r=0;s>r;)h=i.house[this.current_pano][PATH],h=h.replace(/%s/g,i.Config.img_name[a]),h=h.replace(/%h/g,r%2+1),h=h.replace(/%v/g,parseInt(r/2)+1),console.log(h),this.blur_pano.mesh.children[a].children[r].material.map.dispose(),i.clear_images[h]?this.blur_pano.mesh.children[a].children[r].material.map=this.blur_pano.load_clear_texture(h,n[s*a+r]):(h=i.house[this.current_pano][BLUR_PATH],this.blur_pano.mesh.children[a].children[r].material.map=this.blur_pano.load_blur_texture(h,n[s*a+r],a)),this.blur_pano.mesh.children[a].children[r].material.opacity=0,r++;a++}return this.blur_pano.mesh.rotation.y=THREE.Math.degToRad(t),this.blur_pano.mesh.position.x=o*Math.cos(THREE.Math.degToRad(e)),this.blur_pano.mesh.position.z=o*Math.sin(THREE.Math.degToRad(e)),$.when.apply($,n).done(function(){}).promise()},t.prototype.load_clear_pano=function(t){var e,o,n,a,r;if(this.destroy)return $.when().done(function(){}).promise();for(e=[],a=this.clear_pano.img_width/this.clear_pano.tile_width*(this.clear_pano.img_width/this.clear_pano.tile_width),o=0;6*a>o;)e[o]=$.Deferred(),o++;for(this.clear_pano.pano_id=this.current_pano,this.clear_pano.mesh.rotation.y=THREE.Math.degToRad(t),o=0;6>o;){for(n=0;a>n;)r=i.house[this.current_pano][PATH],r=r.replace(/%s/g,i.Config.img_name[o]),r=r.replace(/%h/g,n%2+1),r=r.replace(/%v/g,parseInt(n/2)+1),console.log(r),this.clear_pano.mesh.children[o].children[n].material.map.dispose(),this.clear_pano.mesh.children[o].children[n].material.map=this.clear_pano.load_clear_texture(r,e[a*o+n]),this.clear_pano.mesh.children[o].children[n].material.opacity=0,n++;o++}return $.when.apply($,e).done(function(){}).promise()},t.prototype.old_pano_to_blur_pano=function(t,e,o,n){var a,r,s,h,l,p,d,c,u;if(console.log(n),!this.destroy){for(u=.1,n&&(u=.4,TweenLite.to(i.Config,u,{lon:o,lat:0,ease:Power0.easeOut})),c=1,l=0,n&&(c=2,l=.3),r=this.blur_pano,h=this.clear_pano,TweenLite.to(r.mesh.position,c,{x:0,z:0,delay:l,ease:Expo.easeOut}),a=this.blur_pano.img_width/this.blur_pano.tile_width*(this.blur_pano.img_width/this.blur_pano.tile_width),p=0;6>p;){for(d=0;a>d;)TweenLite.to(r.mesh.children[p].children[d].material,c,{opacity:1,delay:l,ease:Expo.easeOut}),d++;p++}for(s=this.clear_pano.img_width/this.clear_pano.tile_width*(this.clear_pano.img_width/this.clear_pano.tile_width),p=0;6>p;){for(d=0;s>d;)TweenLite.to(h.mesh.children[p].children[d].material,c,{opacity:0,delay:l,ease:Expo.easeOut}),d++;p++}TweenLite.to(h.mesh.position,c,{x:-1*n*Math.cos(THREE.Math.degToRad(e)),z:-1*n*Math.sin(THREE.Math.degToRad(e)),delay:l,ease:Expo.easeOut,onComplete:this.check_new_pano_load.bind(this),onCompleteParams:[t]})}},t.prototype.check_new_pano_load=function(t){var i,e,o,n;if(!this.destroy){for(this.clear_pano.mesh.position.x=0,this.clear_pano.mesh.position.z=0,e=this.clear_pano.img_width/this.clear_pano.tile_width*(this.clear_pano.img_width/this.clear_pano.tile_width),o=0;6>o;){for(n=0;e>n;)this.clear_pano.mesh.children[o].children[n].material.opacity=0,this.clear_pano.mesh.children[o].children[n].material.map.dispose(),n++;o++}for(i=this.blur_pano.img_width/this.blur_pano.tile_width*(this.blur_pano.img_width/this.blur_pano.tile_width);6>o;){for(n=0;i>n;)this.blur_pano.mesh.children[o].children[n].material.opacity=1,n++;o++}this.load_clear_pano(t).done(function(i){return function(){i.blur_pano_to_new_pano(t)}}(this))}},t.prototype.blur_pano_to_new_pano=function(t){var i,e,o,n,a,r,s;if(!this.destroy){for(e=this.blur_pano,n=this.clear_pano,s=.5,i=this.blur_pano.img_width/this.blur_pano.tile_width*(this.blur_pano.img_width/this.blur_pano.tile_width),a=0;6>a;){for(r=0;i>r;)TweenLite.to(e.mesh.children[a].children[r].material,s,{opacity:0,ease:Power0.easeOut}),r++;a++}for(a=0,o=this.clear_pano.img_width/this.clear_pano.tile_width*(this.clear_pano.img_width/this.clear_pano.tile_width);6>a;){for(r=0;o>r;)5===a&&r===o-1?TweenLite.to(n.mesh.children[a].children[r].material,s,{opacity:1,ease:Power0.easeOut,onComplete:this.complete.bind(this),onCompleteParams:[t]}):TweenLite.to(n.mesh.children[a].children[r].material,s,{opacity:1,ease:Power0.easeOut}),r++;a++}}},t.prototype.complete=function(t){var e;this.destroy||(this.clear_pano.mesh.rotation.y=0,i.Config.lon+=t,e=this.current_pano,i.Hotspot.add_hotspots(e).done(function(t){return function(){i.Annotation.add_annotations(e),t.moving=!1}}(this)))},t.prototype.destroy_transition=function(){var t,i;this.destroy=!0,t=this.blur_pano,i=this.clear_pano,TweenLite.killTweensOf(t),TweenLite.killTweensOf(i),this.blur_pano.destroy_pano(),this.clear_pano.destroy_pano(),this.blur_pano=null,this.clear_pano=null},t}(),i.transition=o,t.exports=i}).call(this)},function(t,i,e){(function(){var i,o,n;n=e(4),o=void 0,i=function(){function t(){this.panoid=void 0,this.length=0,this.destroy=!1}return t.prototype.add_annotation=function(t){var i,e,o;e=t,t="annotation_"+t,o=$("<div></div>",{id:t}),o.prepend("<img class='annotation' height='40px' width='40px' src='../test/images/info.png'></img> <div class='hotspot-title'> <div class='hotspot-text'>"+n.house[this.panoid][ANNOTATIONS][e][TITLE]+"</div> </div> <div class='info-hotspot'>"+n.house[this.panoid][ANNOTATIONS][e][DESC]+"</div>"),$("#"+DirectPano.pano_div_id).append(o),i=$("#"+t),i.bind("click touchstart",function(){"visible"===i.find(".info-hotspot").css("visibility")?(i.find(".info-hotspot").css("visibility","hidden"),i.find(".hotspot-title").css("visibility","hidden"),i.find(".hotspot-title").css("opacity","0"),i.find(".annotation").css("border-radius","100px")):(i.find(".info-hotspot").css("visibility","visible"),i.find(".hotspot-title").css("visibility","visible"),i.find(".hotspot-title").css("opacity","1"),i.find(".hotspot-title").css("border-radius","0px 10px 0px 0px"),i.find(".annotation").css("border-radius","10px 0px 0px 0px"))}),i.hover(function(){i.find(".hotspot-title").css("visibility","visible"),i.find(".hotspot-title").css("opacity","1"),"hidden"===i.find(".info-hotspot").css("visibility")&&(i.find(".hotspot-title").css("border-radius","0px 10px 10px 0px"),i.find(".annotation").css("border-radius","10px 0px 0px 10px"))},function(){"hidden"===i.find(".info-hotspot").css("visibility")&&(i.find(".hotspot-title").css("visibility","hidden"),i.find(".hotspot-title").css("opacity","0"),i.find(".annotation").css("border-radius","100px"))})},t.prototype.add_annotations=function(t){var i;this.panoid=t;try{for(this.length=n.house[t][ANNOTATIONS].length,i=0;i<this.length;){if(this.destroy)return void this.remove_annotations();this.add_annotation(i),i++}}catch(e){return void(this.length=0)}},t.prototype.remove_annotations=function(){var t;for(t=0;t<this.length;)$("#annotation_"+t).remove(),t++},t.prototype.destroy_annotation=function(){return this.destroy=!0,this.remove_annotations()},t.prototype.update=function(){var i,e,o,a,r,s,h,l;for(a=0,r=this.panoid;a<this.length;)e="#annotation_"+a,t=$(e),i=n.house[r][ANNOTATIONS][a][LON],h=THREE.Math.degToRad(i),l=new THREE.Vector3(30*Math.cos(h),n.house[r][ANNOTATIONS][a][LAT],30*Math.sin(h)),l.x+=13*Math.cos(h),l.z+=13*Math.sin(h),l=l.project(n.camera),o=$("#"+DirectPano.pano_div_id),s={x:(l.x+1)/2*o.outerWidth(),y:-(l.y-1)/2*o.outerHeight()},t&&(l.x>1||l.x<-1||l.y>1||l.y<-1||l.z>1||l.z<-1?"none"!==t.css("display")&&(t.removeAttr("style"),t.css("display","none")):(t.css("display","inline"),t.css("left","-10px"),t.css("top","0px"),t.css("transform","translate3d("+s.x+"px,"+s.y+"px,0px)"),t.css("position","absolute"),t.css({"font-family":"'Helvetica Neue', Helvetica, Arial, sans-serif"}),t.css("font-size","16px"))),a++},t}(),n.annotation=i,t.exports=n}).call(this)},function(t,i,e){(function(){var i,o;o=e(5),i=function(){function t(){this.panoid=void 0,this.destroy=!1}return t.prototype.load_texture=function(){var t,i,e;return e=new THREE.Texture(window.texture_placeholder),i=new THREE.MeshBasicMaterial({map:e,overdraw:0,side:THREE.DoubleSide,depthTest:!1,depthWrite:!0,opacity:1,transparent:!0}),t=new Image,t.onload=function(){return t.onload=null,e.image=this,e.needsUpdate=!0},t.src="../test/images/logo.png",i},t.prototype.add_hotspot=function(i,e,n){var a,r,s,h,l,p,d,c;r=new THREE.PlaneBufferGeometry(5,5,5),s=this.load_texture(),t=new THREE.Mesh(r,s),l=THREE.Math.degToRad(i),t.position.x=40*Math.cos(l),t.position.y=-10,t.position.z=40*Math.sin(l),t.renderOrder=1,c=new THREE.Vector3(-t.position.x,400,-t.position.z),t.lookAt(c),r=new THREE.PlaneBufferGeometry(1,1,1),h=this.panoid,d="",void 0!==o.house[h][HOTSPOTS][e][TEXT]&&(d=o.house[h][HOTSPOTS][e][TEXT]),t.panoid=o.house[h][HOTSPOTS][e][TO_ID],t.deg_angle=i,a=$("#"+DirectPano.pano_div_id),p=$("<div></div>",{id:"hotspot_"+o.house[h][HOTSPOTS][e][TO_ID]}),p.html(d),$("#"+DirectPano.pano_div_id).append(p),t.hotspot_id=e,t.name="hotspot",o.scene.add(t),n.resolve()},t.prototype.add_hotspots=function(t){var i,e,n;for(this.panoid=t,n=o.house[t][HOTSPOTS].length,i=[],e=0;n>e;)i[e]=$.Deferred(),e++;for(e=0;n>e;){if(this.destroy)return void this.remove_hotspots();this.add_hotspot(o.house[t][HOTSPOTS][e][ANGLE],e,i[e]),e++}return $.when.apply($,i).done(function(){}).promise()},t.prototype.remove_hotspots=function(){var t,i,e,n;for(i=o.scene.children.length,n=0,t=0;i>t;)e=o.scene.children[n],"hotspot"===e.name?(e.geometry.dispose(),e.material.dispose(),o.scene.remove(e),$("#hotspot_"+e.panoid).remove()):n+=1,t++},t.prototype.front_nearest_hotspot=function(t){var i,e,n,a,r,s,h;for(s=o.house[t][HOTSPOTS].length,r=-1,a=void 0,i=!1,e=0;s>e;)h=o.house[t][HOTSPOTS][e][ANGLE],n=(o.Config.lon+360)%360,0>h&&(h+=360),(n>=45&&315>=n&&(n+45)%360>=h&&h>=(n-45+360)%360||45>=n&&h>=0&&n+45>=h||45>=n&&h>=(n-45+360)%360&&360>=h||n>=315&&h>=n-45&&360>=h||n>=315&&h>=0&&(n+45)%360>=h)&&(i===!1||Math.abs(h-n)<Math.abs(a-n))&&(a=h,r=e,i=!0),e++;return r},t.prototype.back_nearest_hotspot=function(t){var i,e,n,a,r,s,h;for(s=o.house[t][HOTSPOTS].length,r=-1,a=void 0,i=!1,e=0;s>e;)h=o.house[t][HOTSPOTS][e][ANGLE],n=(o.Config.lon+360+180)%360,0>h&&(h+=360),(n>=45&&315>=n&&(n+45)%360>=h&&h>=(n-45+360)%360||45>=n&&h>=0&&n+45>=h||45>=n&&h>=(n-45+360)%360&&360>=h||n>=315&&h>=n-45&&360>=h||n>=315&&h>=0&&(n+45)%360>=h)&&(i===!1||Math.abs(h-n)<Math.abs(a-n))&&(a=h,r=e,i=!0),e++;return r},t.prototype.destroy_hotspot=function(){return this.destroy=!0,this.remove_hotspots()},t.prototype.update=function(){var t,i,e,n,a,r,s,h;for(e=o.scene.children.length,i=0;e>i;)n=o.scene.children[i],"hotspot"===n.name&&(s=$("#hotspot_"+n.panoid),h=n.position.clone(),r=THREE.Math.degToRad(n.deg_angle+5),h.x+=13*Math.cos(r),h.z+=13*Math.sin(r),h=h.project(o.camera),t=$("#"+DirectPano.pano_div_id),a={x:(h.x+1)/2*t.outerWidth(),y:-(h.y-1)/2*t.outerHeight()},s&&(h.x>1||h.x<-1||h.y>1||h.y<-1||h.z>1||h.z<-1?"none"!==s.css("display")&&(s.removeAttr("style"),s.css({display:"none"})):s.css({display:"block",left:"-10px",top:"0px",transform:"translate3d("+a.x+"px,"+a.y+"px,0px)","text-align":"left",color:"Yellow",position:"absolute","margin-left":"-20px"}))),i++},t}(),o.hotspot=i,t.exports=o}).call(this)},function(t,i,e){(function(){var i,o,n,a,r,s;a=e(6),s=128,n=[{position:[-s/2,s/2,0]},{position:[s/2,s/2,0]},{position:[-s/2,-s/2,0]},{position:[s/2,-s/2,0]}],o=128,r=[{position:[-1*o,0,0],rotation:[0,Math.PI/2,0]},{position:[o,0,0],rotation:[0,-Math.PI/2,0]},{position:[0,o,0],rotation:[Math.PI/2,0,Math.PI]},{position:[0,-1*o,0],rotation:[-Math.PI/2,0,Math.PI]},{position:[0,0,o],rotation:[0,Math.PI,0]},{position:[0,0,-1*o],rotation:[0,0,0]}],i=function(){function t(t,i){this.pano_id=t,this.is_blur=i,this.name="panorama",this.destroy=!1,this.img_width=512,this.tile_width=512}return t.prototype.create_pano=function(t,i){var e,o,s,h,l,p,d,c,u,_;for(this.mesh=new THREE.Object3D,e=[],p=this.img_width/this.tile_width*(this.img_width/this.tile_width),s=0;6*p>s;)e[s]=$.Deferred(),s++;for(s=0;6>s;){for(h=0,u=new THREE.Object3D;p>h;)d=t,d=d.replace(/%s/g,a.Config.img_name[s]),d=d.replace(/%h/g,h%2+1),d=d.replace(/%v/g,parseInt(h/2)+1),_=void 0,_=this.is_blur?this.load_blur_texture(d,e[p*s+h],s):this.load_clear_texture(d,e[p*s+h]),l=new THREE.MeshBasicMaterial({map:_,overdraw:0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1}),o=new THREE.PlaneBufferGeometry(256/Math.sqrt(p),256/Math.sqrt(p),7,7),c=new THREE.Mesh(o,l),c.material.transparent=!0,c.material.opacity=i,1===p?(c.position.x=0,c.position.y=0,c.position.z=0):(c.position.x=n[h].position[0],c.position.y=n[h].position[1],c.position.z=0),u.add(c),h++;u.rotation.x=r[s].rotation[0],u.rotation.y=r[s].rotation[1],u.rotation.z=r[s].rotation[2],u.updateMatrix(),u.position.x=r[s].position[0],u.position.y=r[s].position[1],u.position.z=r[s].position[2],u.updateMatrix(),this.mesh.add(u),s++}return a.scene.add(this.mesh),$.when.apply($,e).done(function(){}).promise()},t.prototype.destroy_pano=function(){var t,i,e,o;for(this.destroy=!0,a.scene.remove(this.mesh),e=this.img_width/this.tile_width*(this.img_width/this.tile_width),t=0,o=[];6>t;){for(i=0;e>i;)this.mesh.children[t].children[i].material.map.dispose(),this.mesh.children[t].children[i].material.dispose(),this.mesh.children[t].children[i].geometry.dispose(),this.mesh.children[t].children[i]=null,i++;this.mesh.children[t]=null,o.push(t++)}return o},t.prototype.load_clear_texture=function(t,i){var e,o,n;return n=new THREE.Texture(a.texture_placeholder),o=this.pano_id,a.clear_images[t]?(n.image=a.clear_images[t],n.needsUpdate=!0,i.resolve()):(e=new Image,e.onload=function(){e.onload=null,n.image=this,n.needsUpdate=!0,i.resolve(),a.clear_images[t]=e},e.src=t),n},t.prototype.load_blur_texture=function(t,i,e,o){var n,r,s;return s=new THREE.Texture(a.texture_placeholder),r=this.pano_id,a.blur_images[t]?(s.image=a.blur_images[t],s.needsUpdate=!0,s.repeat.x=1,s.repeat.y=256/1536,s.offset.x=0,s.offset.y=a.Config.blur_offset[e]/256*s.repeat.y,console.log(s.repeat.x,s.repeat.y),i.resolve()):(n=new Image,n.onload=function(){n.onload=null,s.image=this,s.needsUpdate=!0,s.repeat.x=1,s.repeat.y=256/1536,s.offset.x=0,s.offset.y=a.Config.blur_offset[e]/256*s.repeat.y,i.resolve(),a.blur_images[t]=n},n.src=t),s},t}(),a.Pano=i,t.exports=a}).call(this)},function(t,i,e){(function(){var i,o,n,a,r;a=e(7),r=void 0,n=void 0,o=!1,i=function(){function t(){this.destroy=!1,this.animate()}return t.prototype.animate=function(){var t;this.destroy||(requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.update(),a.Hotspot.update(),a.Annotation.update(),void 0!==a.Config.target_lon&&void 0!==a.Config.current_lon&&Math.abs(a.Config.target_lon-a.Config.current_lon)>.1&&(a.Transition.moving===!0?(void 0===a.Config.target_lon,a.Config.current_lon=void 0):(a.Config.current_lon=a.Config.current_lon+.15*(a.Config.target_lon-a.Config.current_lon),a.Config.lon=(a.Config.current_lon+360)%360)),void 0!==a.Config.target_lat&&void 0!==a.Config.current_lat&&Math.abs(a.Config.target_lat-a.Config.current_lat)>.1&&(a.Transition.moving===!0?(a.Config.target_lat=void 0,a.Config.current_lat=void 0):(a.Config.current_lat=a.Config.current_lat+.15*(a.Config.target_lat-a.Config.current_lat),a.Config.lat=a.Config.current_lat)),o===!0&&(a.Config.isUserInteracting===!0?o=!1:(t=Date.now()-r,1e3>t?a.Config.lat=n-n*t/1e3:(o=!1,a.Config.lat=0))))},t.prototype.update=function(){var t,i,e;a.Config.isUserInteracting===!1&&a.Config.autoplay===!0&&a.Transition.moving===!1?a.Config.lon+=.2:a.Config.isUserInteracting===!1&&(t=Date.now()-a.Config.stop_time,t>2e3&&(a.Config.autoplay=!0,o=!0,r=Date.now(),n=a.Config.lat)),a.Config.lon=(a.Config.lon+360)%360,a.Config.lat=Math.max(-35,Math.min(35,a.Config.lat)),i=THREE.Math.degToRad(90-a.Config.lat),e=THREE.Math.degToRad(a.Config.lon),a.camera.target.x=500*Math.sin(i)*Math.cos(e),a.camera.target.y=500*Math.cos(i),a.camera.target.z=500*Math.sin(i)*Math.sin(e),a.camera.lookAt(a.camera.target),a.renderer.render(a.scene,a.camera)},t}(),a.animation=i,t.exports=a}).call(this)},function(t,i){(function(){var i,e,o,n,a,r,s,h,l,p,d,c,u,_,f,g;_={},n=void 0,f=void 0,u=void 0,g=void 0,c=new THREE.Raycaster,o={},a={},e=void 0,d=!1,i={img_name:["r","l","u","d","f","b"],blur_offset:[768,1280,256,0,1024,512],isUserInteracting:!1,lon:0,lat:0,stop_time:void 0,autoplay:!0,webgl:!0,current_lon:void 0,target_lon:void 0,current_lat:void 0,target_lat:void 0},l=function(){var t,i;t=$("#"+DirectPano.pano_div_id),t.width(window.innerWidth+"px").height(window.innerHeight+"px"),u.setSize(t.outerWidth(),t.outerHeight()),i=$("#"+DirectPano.image_div_id),i.css({visibility:"hidden"}),$("#panos-list").css("max-height",Math.min(400,window.innerHeight)+"px"),n.aspect=t.outerWidth()/t.outerHeight(),n.updateProjectionMatrix(),d=!0},h=function(){var t,i;t=$("#"+DirectPano.pano_div_id),t.width(DirectPano.initial_width+"px").height(DirectPano.initial_height+"px"),u.setSize(t.outerWidth(),t.outerHeight()),i=$("#"+DirectPano.image_div_id),i.css({visibility:"visible"}),$("#panos-list").css("max-height",Math.min(400,DirectPano.initial_height)+"px"),n.aspect=t.outerWidth()/t.outerHeight(),n.updateProjectionMatrix(),d=!1},s=function(){var t,e;try{return t=$("<canvas/>"),!(!window.WebGLRenderingContext||!t[0].getContext("webgl")&&!t[0].getContext("experimental-webgl"))}catch(o){return e=o,i.webgl=!1,!1}},p=function(){var t;t=$("#"+DirectPano.pano_div_id),t.width(Math.min(DirectPano.initial_width,window.innerWidth)+"px").height(Math.min(DirectPano.initial_height,window.innerHeight)+"px"),$("#panos-list").css("max-height",Math.min(400,DirectPano.initial_height)+"px"),f=new THREE.Scene,g=$("<canvas/>").width(128).height(128),u=s()?new THREE.WebGLRenderer:new THREE.CanvasRenderer,u.setPixelRatio(window.devicePixelRatio),t.append(u.domElement),u.setSize(t.outerWidth(),t.outerHeight()),n=new THREE.PerspectiveCamera(65,t.outerWidth()/t.outerHeight(),1,1100),n.target=new THREE.Vector3(0,0,0),$("#"+DirectPano.image_div_id).bind("touchstart click",function(){l()})},r=function(t){var e,n,r,s,h;for(_.Hotspot=void 0,e=0,r=a.length;r>e;e++)h=a[e],a[h]=null;for(n=0,s=o.length;s>n;n++)h=o[n],o[h]=null;a={},o={},i.lon=0,i.lat=0,i.stop_time=void 0,i.autoplay=!0},$(window).resize(function(){var t;t=$("#"+DirectPano.pano_div_id),d===!1?($("#panos-list").css("max-height",Math.min(400,DirectPano.initial_height)+"px"),t.width(Math.min(DirectPano.initial_width,window.innerWidth)+"px").height(Math.min(DirectPano.initial_height,window.innerHeight)+"px")):($("#panos-list").css("max-height",Math.min(400,window.innerHeight)+"px"),t.width(window.innerWidth+"px").height(window.innerHeight+"px")),u.setSize(t.outerWidth(),t.outerHeight()),n.aspect=t.outerWidth()/t.outerHeight(),n.updateProjectionMatrix()}),p(),_.destroy=r,_.Config=i,_.camera=n,_.scene=f,_.renderer=u,_.blur_images=o,_.clear_images=a,_.texture_placeholder=g,_.raycaster=c,_.escape_fullscreen=h,t.exports=_}).call(this)}]);
